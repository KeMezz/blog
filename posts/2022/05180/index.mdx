---
emoji: ğŸŒ 
title: ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œí•˜ê³  ì—´ëŒí•˜ê¸°
date: "2022-05-18"
tags: ["ê°œë°œ", "react", "multer", "axios"]
slug: 2205180
---

1. Axios
2. React w/JavaScript
3. multer (ë°±ì—”ë“œ)

---

## HTML File Inputì„ í†µí•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ

### íŒŒì¼ íƒ€ì…ì˜ input ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±

```jsx
<form>
  <input type="file" accept="image/png, image/jpeg, image/jpg" />
</form>
```

![file íƒ€ì…ì˜ HTML input](./1.png)

ìœ ì €ê°€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ì°½êµ¬ë¡œì„œ HTML input íƒœê·¸ì˜ `file` íƒ€ì…ì„ ì´ìš©í•˜ê² ìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ë¯¸ì§€ë§Œ ë°›ì„ ê²ƒì´ê¸° ë•Œë¬¸ì— accept ì˜µì…˜ì„ í†µí•´ ì²¨ë¶€ ê°€ëŠ¥í•œ íŒŒì¼ì„ íŠ¹ì • ì´ë¯¸ì§€ íŒŒì¼ í™•ì¥ìë¡œë§Œ ì œí•œí–ˆìŠµë‹ˆë‹¤.

> [file inputì´ë€?](https://developer.mozilla.org/ko/docs/Web/HTML/Element/Input/file), mdn web docs

### onChangeë¡œ ì´ìš©ìì˜ íŒŒì¼ ì²¨ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹

```javascript
const onFileChanges = (event) => console.log(event.target.files);
```

```jsx
<input
  type="file"
  accept="image/png, image/jpeg, image/jpg"
  onChange={(event) => onFileChanges(event)}
/>
```

![FileList ê°ì²´ë¥¼ ì½˜ì†”ì—ì„œ ë´¤ì„ ë•Œ](./2.png)

inputë§Œ ì‘ì„±í•´ì„œëŠ” íŒŒì¼ì„ ì²¨ë¶€í•´ë„ ì´ë¯¸ì§€ ì´ë¦„ë§Œ í‘œì‹œë  ë¿ ì„œë²„ì— ì—…ë¡œë“œí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, inputì— onChange ì´ë²¤íŠ¸ë¥¼ ê±¸ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. input íƒœê·¸ë¥¼ í†µí•´ ë°›ì€ ì´ë¯¸ì§€ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì•Œì•„ì„œ FileList ê°ì²´ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

ì½˜ì†” ìŠ¤í¬ë¦°ìƒ·ì—ì„œ ë³´ë‹¤ì‹œí”¼ FileList ê°ì²´ëŠ”, keyì— ì²¨ë¶€í•œ íŒŒì¼ì˜ indexê°€ ë¶€ì—¬ë˜ê³  valueë¡œ ì²¨ë¶€í•œ File ê°ì²´ê°€ í• ë‹¹ë˜ëŠ” í˜•ì‹ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ valueë¥¼ ì„œë²„ë¡œ ë³´ë‚´ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

> [File ê°ì²´ë€?](https://developer.mozilla.org/ko/docs/Web/API/File), mdn web docs

### ì²¨ë¶€í•œ Fileì„ ì„œë²„ì— ì—…ë¡œë“œ

```javascript
const uploadFiles = axios.create({
  baseURL, // ì´ë¯¸ ì„ ì–¸ë˜ì—ˆë‹¤ê³  ê°€ì •í•¨
  headers: { "Content-type": "multipart/form-data" },
  timeout: 5000,
});

const onFileChanges = ({ target: { files } }) => {
  uploadFiles
    .post("/upload", { image_file: files[0] })
    .then(({ data: { images } }) => setImagesList(images));
};
```

```jsx
<Lists>
  {imagesList.map((image, index) => (
    <List key={index}>{image.image_name}</List>
  ))}
</Lists>
```

íŒŒì¼ ê°ì²´ë¥¼ ë³´ë‚¼ ë•Œì—ëŠ” ë°˜ë“œì‹œ í—¤ë”ì˜ `Content-type`ì„ `multipart/form-data`ë¡œ ì„¤ì •í•´ì£¼ì–´ì•¼ ë°±ì—”ë“œì—ì„œ íŒŒì¼ ê°ì²´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì½ì„ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ ì™¸ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ë‹¤ë¥¸ post ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ë•Œì™€ ë™ì¼í•©ë‹ˆë‹¤.

ì œ ê²½ìš°ì—ëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ì„œë²„ì—ì„œ ê·¸ ì‘ë‹µê°’ìœ¼ë¡œ ì§€ê¸ˆê¹Œì§€ ì—…ë¡œë“œ ëœ ì´ë¯¸ì§€ë“¤ì˜ íŒŒì¼ ì´ë¦„ ëª©ë¡ì„ ë°›ë„ë¡ í•´ì„œ, ì—…ë¡œë“œ í•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì‘ë‹µê°’ì„ í†µí•´ ì´ë¯¸ì§€ ëª©ë¡ì„ ë‹¤ì‹œ ìµœì‹ í™”ì‹œí‚¤ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ë‹µìœ¼ë¡œ ë°›ì€ ë¦¬ìŠ¤íŠ¸ë¥¼ í†µí•´ ë‹¤ì‹œ ì´ë¯¸ì§€ ëª©ë¡ ë°°ì—´ stateë¥¼ ìµœì‹ í™”í•˜ëŠ” ê³¼ì •ê¹Œì§€ ì¶”ê°€í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

## ê¸°ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ íŒŒì¼ì— ëŒ€í•œ ì—´ëŒ ìš”ì²­

### multerë¥¼ í†µí•´ ì‘ë‹µ ë°›ì€ ë°”ì´ë„ˆë¦¬ íŒŒì¼ í™•ì¸

```javascript
const downloadFiles = axios.create({
  baseURL,
  headers: { "Content-type": "application/json; charset=UTF-8" },
  timeout: 5000,
});
```

```javascript
const onImageListClick = (imageId) => {
  downloadFiles.post("/registration/download", { imageId }).then(({ data }) => {
    console.log(data);
  });
};
```

![blob ë³€í™˜ ì „ì˜ ì½˜ì†” ë¡œê·¸](./3.png)

ê¸°ì¡´ì— ì—…ë¡œë“œ í–ˆë˜ íŒŒì¼ì„ ë‹¤ì‹œ ì—´ëŒí•˜ê¸° ìœ„í•´, ë°±ì—”ë“œì™€ ì•½ì†í•œ ê° ì´ë¯¸ì§€ì˜ ê³ ìœ  IDë¥¼ ë‹´ì•„ ìƒˆë¡­ê²Œ ìš”ì²­ì„ ë§Œë“¤ì–´ì„œ ë³´ëƒˆìŠµë‹ˆë‹¤.

ë‹¹ì‹œ ë°±ì—”ë“œëŠ” multerë¥¼ ì‚¬ìš© ì¤‘ì´ì—ˆê³ , multerì˜ ë‚´ì¥ í•¨ìˆ˜ ì¤‘ í•˜ë‚˜ì¸ `sendFile()`ì„ í†µí•´ í”„ë¡ íŠ¸ì—ì„œ ìš”ì²­ë°›ì€ ì´ë¯¸ì§€ IDì™€ ì¼ì¹˜í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì°¾ì•„ì„œ ì‘ë‹µí•´ì£¼ëŠ” í˜•ì‹ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆëŠ”ë°, ê·¸ë¬ë”ë‹ˆ ì½˜ì†”ì—ì„œ ìœ„ì™€ ê°™ì€ ì™¸ê³„ì–´ë¥¼ ë§Œë‚  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ ìƒíƒœë¡œëŠ” ë°›ì€ ì´ë¯¸ì§€ë¥¼ ë¸Œë¼ìš°ì €ê°€ í•´ì„í•  ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” ì´ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ë³€í™˜í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

### responseType ì„¤ì •

```javascript
export const downloadFiles = axios.create({
  baseURL,
  headers: { "Content-type": "application/json; charset=UTF-8" },
  responseType: "blob",
  timeout: 5000,
});
```

![blobìœ¼ë¡œ ë³€í™˜ ëœ íŒŒì¼ì˜ ì½˜ì†” ë¡œê·¸](./4.png)

ì•ì„œ ì—…ë¡œë“œ ê³¼ì •ì—ì„œ í—¤ë”ì˜ `Content-Type`ì„ `multipart/form-data`ë¡œ ì§€ì •í•´ì£¼ì—ˆë˜ê²ƒ ê¸°ì–µë‚˜ì‹œë‚˜ìš”? ë§ˆì°¬ê°€ì§€ë¡œ ë‹¤ì‹œ ë°›ì„ ë•Œë„ ì˜¬ë°”ë¥¸ ì‘ë‹µ í˜•ì‹ì„ ì§€ì •í•´ì¤„ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. `responseType`ì„ `blob`ìœ¼ë¡œ ì„¤ì •í•´ì£¼ë©´, ë°”ì´ë„ˆë¦¬ íŒŒì¼ì´ ì™¸ê³„ì–´ ëŒ€ì‹  Blob ê°ì²´ë¡œ ì˜ˆì˜ê²Œ ë‹´ê²¨ì ¸ì„œ ì˜¤ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Blob ê°ì²´ë¥¼ File ê°ì²´ë¡œ ë³€í™˜

```javascript
const onImageListClick = (imageId) => {
  downloadFiles.post("/download", { imageId }).then(({ data }) => {
    const newFile = new File([data], url);
  });
};
```

ë³€í™˜í•œ Blob ê°ì²´ë¥¼ ìƒì„±ì ë¬¸ë²•ì„ í†µí•´ ìš°ë¦¬ê°€ ì²˜ìŒì— ë³´ëƒˆë˜ File ê°ì²´ë¡œ ë³€í™˜ì‹œì¼œì¤ë‹ˆë‹¤. ì´ë¡œì„œ ìµœì´ˆ ì²¨ë¶€íŒŒì¼ì— ë‹´ê²¼ë˜ í˜•íƒœê¹Œì§€ ë˜ëŒë¦¬ëŠ”ë°ì—ëŠ” ì„±ê³µ í–ˆìŠµë‹ˆë‹¤.

### FileReaderë¥¼ í†µí•´ File ê°ì²´ë¥¼ ë¸Œë¼ìš°ì €ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ì´ë¯¸ì§€ ë§í¬ë¡œ ë³€í™˜

```javascript
const onImageListClick = async (imageId) => {
  await downloadFiles.post("/download", { imageId }).then(({ data }) => {
    const newFile = new File([data], imageId);
    const reader = new FileReader(); // 1
    reader.onload = (event) => {
      const previewImage = String(event.target?.result);
      setImageURL(previewImage); // 2
    };
    reader.readAsDataURL(newFile); // 3
  });
  /* í›„ëµ */
};
```

```jsx
return (
  <>
    <Lists>
      {imagesList.map((image, index) => (
        <List key={index} onClick={() => onImageListClick(image.imageId)}>
          [{index}] {image.image_name}
        </List>
      ))}
    </Lists>
    <Preview>
      <img src={imageURL} alt={imageName} />
    </Preview>
  </>
);
```

1. ë³€í™˜í•œ File ê°ì²´ë¥¼ ì½ê¸° ìœ„í•´ FileReader ê°ì²´ ìƒì„±

   > **`FileReader`** ê°ì²´ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì½ê¸° ìœ„í•˜ì—¬ ì½ì„ íŒŒì¼ì„ ê°€ë¦¬í‚¤ëŠ”[`File`](https://developer.mozilla.org/ko/docs/Web/API/File) í˜¹ì€ [`Blob`](https://developer.mozilla.org/ko/docs/Web/API/Blob) ê°ì²´ë¥¼ ì´ìš©í•´ íŒŒì¼ì˜ ë‚´ìš©ì„ (í˜¹ì€ raw data ë²„í¼ë¡œ) ì½ê³  ì‚¬ìš©ìì˜ ì»´í“¨í„°ì— ì €ì¥í•˜ëŠ” ê²ƒì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.
   >
   > [FileReader](https://developer.mozilla.org/ko/docs/Web/API/FileReader), mdn web docs

2. FileReaderê°€ ëª¨ë‘ ë¡œë“œê°€ ëœ ì´í›„ì— ì´ë²¤íŠ¸ íƒ€ê²Ÿì„ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë³€í™˜ì‹œí‚¨ í›„, img íƒœê·¸ì˜ src ì£¼ì†Œê°€ ë  stateì— ê°’ì„ ë³µì‚¬

   **`onload`**ëŠ” `FileReader` ê°ì²´ì˜ ì½ê¸° ë™ì‘ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œë§ˆë‹¤ ì‹¤í–‰í•  ì¼ì„ ì •í•  ìˆ˜ ìˆëŠ” ë¹„ë™ê¸° ë©”ì†Œë“œì…ë‹ˆë‹¤.

3. reader.readAsDataURLë¥¼ í†µí•´ ì•„ê¹Œ ë³€í™˜í•œ íŒŒì¼ ê°ì²´ë¥¼ ë„˜ê¸°ë©´ ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ë§í¬ê°€ ìƒì„±

   > [readAsDataURL](https://developer.mozilla.org/ko/docs/Web/API/FileReader/readAsDataURL), mdn web docs

### ìš”ì²­í•œ ì´ë¯¸ì§€ê°€ ì˜ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

![íŒŒì¼ì´ ì˜ ì—…ë¡œë“œ ëœ ì‚¬ì§„](./5.png)

ë~

---

#### ì°¸ê³ í•œ ê¸€

- [React + TypeScriptì—ì„œ Axiosë¡œ Blob ì´ë¯¸ì§€ë¥¼ ë°›ê¸°](https://velog.io/@hyunheal/Axiosë¡œ-Blob-ì´ë¯¸ì§€ë¥¼-ë°›ê¸°)
- [ì„œë²„ì—ì„œ ë‹¤ìš´ë°›ì€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ img íƒœê·¸ì— ë„£ê³  ì´ë¯¸ì§€ë¡œ í‘œì‹œí•˜ëŠ” ë°©ë²•?](https://webcorgi.tistory.com/40)
