---
emoji: ğŸ“œ
title: FlatListì™€ React Queryë¡œ Infinite Scroll êµ¬í˜„í•˜ê¸°
date: "2023-01-02"
tags:
  [
    "ê°œë°œ",
    "React Native",
    "TypeScript",
    "React Query",
    "TanStack",
    "TanStack Query",
    "Infinite Scroll",
  ]
slug: 3
---

FlatListëŠ” ScrollViewì™€ëŠ” ë‹¤ë¥´ê²Œ ëª‡ ê°€ì§€ íŠ¹ìˆ˜í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•˜ëŠ”ë°, ê·¸ ì¤‘ í•˜ë‚˜ê°€ ì¸í”¼ë‹ˆíŠ¸ ìŠ¤í¬ë¡¤ì˜ ì†ì‰¬ìš´ êµ¬í˜„ì´ë‹¤. ì´ ê¸€ì—ì„œëŠ” React Queryì™€ ì—°ë™í•˜ì—¬ ë¹ ë¥´ê²Œ ì¸í”¼ë‹ˆíŠ¸ ìŠ¤í¬ë¡¤ì´ ê°€ëŠ¥í•œ ë·°ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ì†Œê°œí•˜ê³ ì í•œë‹¤.

## FlatListì˜ prop ì‚´í´ë³´ê¸°

### onEndReached

```tsx
const onEndReached = () => {
  console.log("end reached!");
};

return (
  <FlatList
    onEndReached={onEndReached}
    data={data?.results}
    /* ... */
  />
);
```

`onEndReached` ëŠ” ì‚¬ìš©ìì˜ ìŠ¤í¬ë¡¤ì´ ë¦¬ìŠ¤íŠ¸ì˜ ëë¶€ë¶„ì— ë„ë‹¬í–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ë¥¼ ì „ë‹¬í•œë‹¤. ë‚˜ì¤‘ì— ì´ ê³³ì— ë‹¤ìŒ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ë„£ìœ¼ë©´ ëœë‹¤.

### onEndReachedThreshold

```tsx
const onEndReached = () => {
  console.log("end reached!");
};

return (
  <FlatList
    onEndReached={onEndReached}
    onEndReachedThreshold={0.75}
    data={data?.results}
    /* ... */
  />
);
```

ì´ ì˜µì…˜ì€ ìŠ¤í¬ë¡¤ì´ ì–´ë””ê¹Œì§€ ì§„í–‰ë˜ì—ˆì„ë•Œ `onEndReached` í•¨ìˆ˜ë¥¼ íŠ¸ë¦¬ê±°í• ì§€ë¥¼ ì •í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ê¸°ë³¸ê°’ì€ ì•„ë§ˆ 1ë¡œ ë˜ì–´ ìˆëŠ” ê²ƒ ê°™ì€ë°, ê·¸ë˜ì„œ ì™„ì „íˆ ìŠ¤í¬ë¡¤ì„ ëê¹Œì§€ ë‚´ë ¤ì•¼ì§€ë§Œ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤. ìœ„ ì²˜ëŸ¼ `0.75`ë¡œ ë„£ì–´ì£¼ë©´ ìŠ¤í¬ë¡¤ì˜ 75% ì§€ì ë§Œ ì§€ë‚˜ê°€ë„ í•¨ìˆ˜ë¥¼ ë¯¸ë¦¬ ì‹¤í–‰ì‹œì¼œì£¼ê¸° ë•Œë¬¸ì— ë¡œë”© ì‹œê°„ì„ ê°ì†Œì‹œí‚¬ ìˆ˜ ìˆë‹¤.

## React Queryì˜ Infinite Queries

```json
// this is the result of `console.log(data)`
{
	pageParams: [undeinfed],
	pages: [
		{
			page: 1,
			total_page: 8,
			results: [
				/* ... */
			],
		},
		{
			page: 2,
			total_page: 8,
			results: [
				/* ... */
			],
		},
	]
}
```

`useInfiniteQuery` í›…ì„ ì´ìš©í•˜ë©´ ì¸í”¼ë‹ˆíŠ¸ ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ëŠ”ë° ë§ì€ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. í•´ë‹¹ í›…ì„ ì´ìš©í•´ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ì—´ì–´ë³´ë©´ ëŒ€ëµ ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ, ì¼ë°˜ì ì¸ `useQuery` í›…ì„ ì‚¬ìš©í•´ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ì™€ëŠ” ë‹¬ë¦¬ `pageParams`ë¼ëŠ” í•­ëª©ì´ ìˆê³ , ìš°ë¦¬ê°€ ì›ë˜ ë°›ì•„ì•¼ í•  ë°ì´í„°ëŠ” `pages` ì•ˆì— ë°°ì—´ í˜•íƒœë¡œ ë‹´ê²¨ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## FlatListì— ì „ë‹¬í•  data í˜•ì‹ ë³€ê²½

```tsx
const { isInitialLoading, data } = useQuery<DataResults>(["data"], fetchData);
/* ... */
return (
  <FlatList
    data={data?.results}
    /* ... */
  />
);
```

ê¸°ì¡´ì— `useQuery`ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆì—ˆë‹¤ë©´ ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ ì‘ì„±ë˜ì–´ ìˆì—ˆì„ ê²ƒì´ë‹¤. ê·¸ëŸ¬ë‚˜ ì•ì„œ ì‚´í´ ë³´ì•˜ë“¯ì´ `useInfiniteQuery`ë¡œ ë³€ê²½ë¨ìœ¼ë¡œì„œ ê²°ê³¼ë¡œ ë°›ëŠ” ë°ì´í„°ì˜ í˜•ì‹ì´ ë‹¬ë¼ì¡Œê¸° ë•Œë¬¸ì— ê·¸ì— ë§ëŠ” í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ì–´ì•¼ í•œë‹¤.

```tsx
const { isInitialLoading, data } = useInfiniteQuery<DataResults>(
  ["data"],
  fetchData
);
/* ... */
return (
  <FlatList
    data={data?.pages.map((page) => page.results).flat()}
    /* ... */
  />
);
```

`useInfitieQuery`ë¥¼ í†µí•´ ë°›ì•„ì˜¨ ë°ì´í„°ëŠ” `pages` ë°°ì—´ ì•ˆì— ê° í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” ë°°ì—´ì´ ë˜ ë“¤ì–´ìˆëŠ” í˜•íƒœê°€ ëœë‹¤. ì¸í”¼ë‹ˆíŠ¸ ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” í•˜ë‚˜ì˜ ë°°ì—´ì•ˆì— ëª¨ë“  ë°ì´í„°ê°€ ë‚˜ì—´ë˜ëŠ” ê²ƒì´ í›¨ì”¬ í¸í•˜ë¯€ë¡œ, ìœ„ì²˜ëŸ¼ `flat()` ë©”ì†Œë“œë¥¼ í†µí•´ ë°°ì—´ì„ ì „ë¶€ ë‹¤ë¦¼ì§ˆ í•´ì¤€ë‹¤.

## React Queryì—ê²Œ í˜ì´ì§€ ì •ë³´ ì•Œë ¤ì£¼ê¸°

```typescript
const fetchData = (pageParam: number) =>
  fetch(`${BASE_URL}?api_key=${API_KEY}&page=${pageParam}`).then((res) =>
    res.json()
  );
const { isInitialLoading, data } = useInfiniteQuery<DataResults>(
  ["data"],
  ({ pageParam }) => fetchData(pageParam)
);
```

`useInfiniteQuery`ë¥¼ ì´ìš©í•˜ë©´ `fetchFn`ì—ê²Œ `pageParam`ì´ë¼ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ì œê³µí•œë‹¤. ì´ë¥¼ ì—°ê²°í•´ì£¼ë©´ React Queryê°€ `fetchFn`ì„ í†µí•´ ì„œë²„ì—ê²Œ ìš”ì²­í•  í˜„ì¬ í˜ì´ì§€ ê°’ì„ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

```typescript
const { isInitialLoading, data } = useInfiniteQuery<DataResults>(
  ["data"],
  ({ pageParam }) => fetchData(pageParam),
  {
    getNextPageParam: (lastPage) => {
      const nextPage = lastPage.page + 1;
      return nextPage > lastPage.total_pages ? null : nextPage;
    },
  }
);
```

ë‹¤ìŒìœ¼ë¡œ `getNextPageParam`ë„ ì œê³µí•˜ëŠ”ë°, ë‹¤ìŒ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ìš”ì²­í•  ë•Œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ë§¤ê°œë³€ìˆ˜ë¡œ ìµœê·¼ í˜ì´ì§€ ë°ì´í„°ë¥¼ ì œê³µí•´ì£¼ë¯€ë¡œ, ìœ„ì²˜ëŸ¼ ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë„ë‹¬í–ˆì„ë•Œ nullì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•˜ë©´, React Queryì—ê²Œ ìµœëŒ€ í˜ì´ì§€ ìˆ˜ë¥¼ ì•Œë ¤ì¤€ ê²ƒê³¼ ê°™ë‹¤.

## onEndReached í•¨ìˆ˜ ì™„ì„±í•˜ê¸°

```typescript
const { isInitialLoading, data, hasNextPage, fetchNextPage } =
  useInfiniteQuery<DataResults>(
    ["data"],
    ({ pageParam }) => fetchData(pageParam),
    {
      getNextPageParam: (lastPage) => {
        const nextPage = lastPage.page + 1;
        return nextPage > lastPage.total_pages ? null : nextPage;
      },
    }
  );
```

ì´ì œ `useInfiniteQuery`ì—ì„œ `hasNextPage`ì™€ `fetchNextPage`ë¥¼ ì¶”ê°€ë¡œ êº¼ë‚´ì˜¨ë‹¤. `hasNextPage`ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë°˜í™˜í•˜ê³ , `fetchNextPage`ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ fetch í•´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤.

```tsx
const onEndReached = () => {
  if (hasNextPage) {
    fetchNextPage();
  }
};

return (
  <FlatList
    onEndReached={onEndReached}
    onEndReachedThreshold={0.75}
    data={data?.pages.map((page) => page.results).flat()}
    /* ... */
  />
);
```

onEndReached í•¨ìˆ˜ë¥¼ ìœ„ì²˜ëŸ¼ ìˆ˜ì •í•´ì¤€ë‹¤. FlatListì˜ ìŠ¤í¬ë¡¤ì´ Thresholdì— ë‹¿ì•˜ì„ ë•Œ, ë‹¤ìŒ í˜ì´ì§€ê°€ ì¡´ì¬í•œë‹¤ë©´ ë‹¤ìŒ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ê²Œ ëœë‹¤.

## ê²°ë¡ 

ì´ë¡œì¨ ì§ì ‘ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í–ˆë‹¤ë©´ ì •ë§ ì˜¤ë˜ê±¸ë¦¬ê³  ë³µì¡í–ˆì„ ì½”ë“œê°€ React Queryê°€ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œë¡œ ë„ˆë¬´ë‚˜ë„ ê°„ë‹¨í•˜ê²Œ í•´ê²°ì´ ë˜ì—ˆë‹¤! ê°œì¸ì ìœ¼ë¡œëŠ” ì•„ì§ê¹Œì§€ ì‹¤ë¬´ì—ì„œ React Queryë¥¼ í™œìš©í•  ê¸°íšŒê°€ ì—†ì—ˆê¸° ë•Œë¬¸ì— ëª» ì¨ë³¸ ê¸°ëŠ¥ì´ ë§ì•˜ëŠ”ë° í•˜ë‚˜ì”© ê³µë¶€í•´ê°€ë‹¤ë³´ë‹ˆ ë” ìì£¼ ì¨ë³´ë©´ì„œ ê¸°ëŠ¥ì„ ìµí˜€ë‘ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ íŒíŒ ë“¤ì—ˆë‹¤!

> [FlatList | React Native Docs](https://reactnative.dev/docs/flatlist)

> [useInfiniteQuery | TanStack Query Docs](https://tanstack.com/query/v4/docs/react/reference/useInfiniteQuery)
