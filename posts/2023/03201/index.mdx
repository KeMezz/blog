---
emoji: ðŸš—
title: Sequelizeë¥¼ í†µí•´ ì¿¼ë¦¬ë¬¸ ì—†ì´ DB ì—°ê²°í•˜ê¸°
date: "2023-03-20"
tags: ["ê°œë°œ", "express", "node.js", "mysql", "sequelize"]
slug: 2303201
---

> Sequelizeë¥¼ ì´ìš©í•˜ë©´ ì¿¼ë¦¬ë¬¸ì„ ì§ì ‘ ìž‘ì„±í•˜ì§€ ì•Šê³  Javascript ì½”ë“œë§Œì„ ì´ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ í…Œì´ë¸”ê³¼ ì»¬ëŸ¼ ë“±ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤. ì¼ë¶€ ìƒí™©ì—ì„œëŠ” ì œì•½ë„ ìžˆì§€ë§Œ ë³µìž¡í•œ ì¿¼ë¦¬ë¬¸ì´ í•„ìš”ì—†ëŠ” ì•±ì—ì„œëŠ” ì¶©ë¶„ížˆ ë§¤ë ¥ì ì¸ ëŒ€ì•ˆì´ ë  ìˆ˜ ìžˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Express ì•±ì—ì„œ Sequelizeë¥¼ í†µí•´ MySQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë©”ëª¨í•´ë³´ê² ë‹¤.

[sequelize.org](https://sequelize.org)

## Sequelize ì„¤ì¹˜ ë° ì—°ê²°

### íŒ¨í‚¤ì§€ ì„¤ì¹˜

```sh
yarn add sequelize
```

[Getting Started | Sequelize Docs](https://sequelize.org/docs/v6/getting-started/)

### ì—°ê²° ì„¤ì •

```javascript
import { config } from "../config.js";
import { Sequelize } from "sequelize";

const { database, user, password, host, port } = config.db;

export const sequelize = new Sequelize(database, user, password, {
  host,
  port,
  dialect: "mysql",
});
```

Sequelize í´ëž˜ìŠ¤ë¥¼ ìœ„ì²˜ëŸ¼ ìž„í¬íŠ¸í•˜ì—¬ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤. ê³µì‹ë¬¸ì„œì—ë„ ìž˜ ë‚˜ì™€ìžˆì§€ë§Œ ìƒˆ sequelize ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ë•Œ database, username, password ìˆœìœ¼ë¡œ ë„˜ê²¨ì¤€ í›„ì— ì˜µì…˜ ì˜¤ë¸Œì íŠ¸ë¡œ dialect ì •ë³´ê¹Œì§€ ë„˜ê²¨ì£¼ë©´ ëœë‹¤.

```javascript
import { sequelize } from "./db/database.js";

sequelize.sync().then(() => {
  const server = app.listen(config.host.port);
});
```

ê·¸ë¦¬ê³  sync í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ Sequelizeì™€ ìµœì¢…ì ìœ¼ë¡œ ì—°ê²°í•´ì¤€ ë’¤ì— ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ì„œë²„ë¥¼ ì—´ì–´ì£¼ë©´ ì—°ê²°ì´ ì™„ë£Œëœë‹¤.

## í…Œì´ë¸” ìƒì„±

```javascript
import { DataTypes } from "sequelize";
import { sequelize } from "../db/database.js";

const Tweet = sequelize.define("tweets", {
  id: {
    type: DataTypes.INTEGER,
    autoIncrement: true,
    primaryKey: true,
    allowNull: false,
  },
  text: {
    type: DataTypes.TEXT,
    allowNull: false,
  },
});
```

`sequelize.define`ì„ ì´ìš©í•˜ë©´ ìƒˆë¡œìš´ í…Œì´ë¸”ê³¼ ì»¬ëŸ¼ì˜ íŠ¹ì„±ì„ ì •ì˜í•  ìˆ˜ ìžˆë‹¤. ì´ë ‡ê²Œ ìƒì„±í•˜ë©´ ì¿¼ë¦¬ë¬¸ ìž‘ì„±ì„ ì „í˜€ í•˜ì§€ ì•Šê³  ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë§Œì„ ì´ìš©í•˜ì—¬ í…Œì´ë¸”ì„ ë§Œë“¤ ìˆ˜ ìžˆê²Œ ëœë‹¤. (Sequelizeì—ì„œëŠ” Model ì´ë¼ê³  ë¶€ë¥¸ë‹¤.) ë³„ë„ì˜ ì˜µì…˜ì„ ë„˜ê¸°ì§€ ì•Šìœ¼ë©´ `updatedAt`ê³¼ `createdAt` ë“±ì˜ íƒ€ìž„ìŠ¤íƒ¬í”„ë„ ì•Œì•„ì„œ ì°ì–´ì¤€ë‹¤.

```javascript
import { User } from "./users.js";

Tweet.belongsTo(User);
```

foreignKeyë¥¼ í†µí•´ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ ì—°ê²°í•˜ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” ìœ„ì²˜ëŸ¼ ì½”ë“œ í•œì¤„ì´ë©´ ëœë‹¤. ì•„ëž˜ ìŠ¤í¬ë¦°ìƒ·ì„ ë³´ë©´ ì•Œì•„ì„œ í•´ë‹¹ í…Œì´ë¸”ì˜ primaryKeyë¥¼ í†µí•´ foreignKeyë¥¼ ìƒì„±í•´ì¤€ ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.

![dbeaver-community í”„ë¡œê·¸ëž¨ì—ì„œ ìžë™ìœ¼ë¡œ ìƒì„±ëœ foreignKeyë¥¼ í™•ì¸í•˜ëŠ” ìŠ¤í¬ë¦°ìƒ·](./1.png)

ì»¬ëŸ¼ëª…ë„ ì•Œì•„ì„œ ì„¼ìŠ¤ìžˆê²Œ `í…Œì´ë¸”ëª…+primaryKey` ì´ë¦„ìœ¼ë¡œ ë¶™ì—¬ì¤€ë‹¤. í˜¹ì€ ì˜µì…˜ì„ í†µí•´ foreignKey ëª…ì¹­ì„ ì»¤ìŠ¤í…€ í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

[Providing the foreign key name directly | Sequelize Docs](https://sequelize.org/docs/v6/core-concepts/assocs/#providing-the-foreign-key-name-directly)

## ì¿¼ë¦¬ í•¨ìˆ˜ ìž‘ì„±

```javascript
export const create = async (user) => {
  return User.create(user).then(({ dataValues }) => dataValues.id);
};

export const findByUsername = async (username) => {
  return User.findOne({ where: { username } });
};

export const findById = async (id) => {
  return User.findByPk(id);
};
```

`create()`ë¥¼ ì´ìš©í•˜ë©´ ì•Œì•„ì„œ ë§¤ê°œë³€ìˆ˜ ê°’ì„ INSERT í•´ì£¼ë©°, `findOne`ì€ ì¡°ê±´ì— ë§žëŠ” ê²°ê³¼ë¥¼ í•˜ë‚˜ë§Œ ì°¾ì•„ì„œ ë°˜í™˜í•˜ê³  ì˜µì…˜ì„ í†µí•´ where ì ˆì— í•´ë‹¹í•˜ëŠ” ì¡°ê±´ì„ ì œê³µí•  ìˆ˜ ìžˆë‹¤. `findByPk`ëŠ” ì£¼ì–´ì§„ ê°’ì´ í…Œì´ë¸”ì˜ `primaryKey`ì™€ ì¼ì¹˜í•˜ëŠ” ì»¬ëŸ¼ì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤.

ì´ì™¸ì—ë„ `save()`ë‚˜ `destory()` ë“±ì˜ ë©”ì†Œë“œë¥¼ í†µí•´ updateë‚˜ delete ëª…ë ¹ì„ ìˆ˜í–‰í•˜ëŠ” ë“±, ë‹¤ì–‘í•œ íŽ¸ì˜ ê¸°ëŠ¥ì´ ìžˆìœ¼ë¯€ë¡œ ê³µì‹ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

## ì¶”ê°€) ê²°ê³¼ ì˜¤ë¸Œì íŠ¸ í‰íƒ„í™”í•˜ê¸°

ê´€ê³„í˜•ì˜ ì‘ë‹µ ë°ì´í„°ë¡œ foreignKeyë¥¼ ì´ìš©í•´ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìžˆëŠ” ë°ì´í„°ë¥¼ í•¨ê»˜ ë³´ë‚´ì£¼ê³  ì‹¶ì„ ë•Œê°€ ìžˆë‹¤. ì´ëŸ´ ë•Œ include ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ê´€ë ¨ëœ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ í•¨ê»˜ ë³´ë‚´ì¤„ ìˆ˜ ìžˆëŠ”ë°, ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì˜¤ë¸Œì íŠ¸ ì—¬ëŸ¬ê°œê°€ ì¤‘ì²©ëœ í˜•íƒœë¡œ ë³´ë‚´ì£¼ê²Œ ëœë‹¤. ì´ë•Œ ì›í•˜ëŠ” ë°ì´í„° í˜•íƒœë¡œ í‰íƒ„í™” í•´ì¤„ ìˆ˜ ìžˆëŠ” ë°©ë²•ì´ ìžˆë‹¤.

```javascript
import { sequelize } from "../db/database.js";

export const getAll = async () => {
  return Tweet.findAll({
    include: {
      model: User,
      attributes: [],
    },
  });
};
```

ë¨¼ì € include ì˜µì…˜ì„ ì´ìš©í•˜ë©´ ì•žì„œ ë§í–ˆë“¯ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ í•¨ê»˜ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìžˆë‹¤. attributes ì˜µì…˜ ì•ˆì—ëŠ” ê°€ì ¸ì˜¤ê³  ì‹¶ì€ ëª¨ë¸ ì¤‘ì—ì„œ ë˜ ë‹¤ì‹œ ì˜¤ë¸Œì íŠ¸ê°€ ì¤‘ì²©ë˜ê¸°ë¥¼ ì›í•˜ëŠ” ê°’ì´ ìžˆë‹¤ë©´ ë°°ì—´ ì•ˆì— ë„˜ê¸°ë©´ ëœë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ëª¨ë¸ ë‚´ì—ì„œ ì¤‘ì²©ëœ ì˜¤ë¸Œì íŠ¸ê¹Œì§€ëŠ” ë”¸ë ¤ì˜¤ì§€ ì•Šê¸°ë¥¼ ì›í•  ë•ŒëŠ” attributesì— ë¹ˆ ë°°ì—´ì„ ë„˜ê¸°ë©´ ê·¸ë³´ë‹¤ ë” ì¤‘ì²©ëœ ì˜¤ë¸Œì íŠ¸ëŠ” ì œì™¸í•œ ì±„ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìžˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ë‹¨ê³„ê¹Œì§€ ë§ˆì³ë„ ì•„ì§ user ëª¨ë¸ ì•ˆì˜ ì •ë³´ë“¤ì€ userë¼ëŠ” í‚¤ ì•ˆì— ì˜¤ë¸Œì íŠ¸ í˜•íƒœë¡œ ë‹´ê¸´ ì±„ ì „ë‹¬ì´ ëœë‹¤.

[Specifying attributes from the through table | Sequelize Docs](https://sequelize.org/docs/v6/advanced-association-concepts/advanced-many-to-many/#specifying-attributes-from-the-through-table)

```javascript
import { sequelize } from "../db/database.js";

export const getAll = async () => {
  return Tweet.findAll({
    attributes: [
      "id",
      "text",
      "createdAt",
      "userId",
      [Sequelize.col("user.username"), "username"],
      [Sequelize.col("user.url"), "url"],
    ],
    include: {
      model: User,
      attributes: [],
    },
  });
};
```

attributes ì˜µì…˜ì˜ ì—­í• ì„ ì•Œì•˜ì„í…Œë‹ˆ ì—¬ê¸°ì„œë„ ë™ì¼í•œ ë£°ì´ ì ìš©ëœë‹¤. ì´ì œ ë°°ì—´ ì•ˆì— ë„˜ê¸´ ê°’ ì´ì™¸ì—ëŠ” ì¤‘ì²©ëœ user ì˜¤ë¸Œì íŠ¸ëŠ” í‘œì‹œë˜ì§€ ì•Šê²Œ ëœë‹¤. ìš°ì„  attributes ì˜µì…˜ ì•ˆì— ê¸°ì¡´ í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¤ê³  ì‹¶ì€ í‚¤ë¥¼ í•˜ë‚˜ì”© ìž…ë ¥í•´ì£¼ê³ , ë§ë¶™ì—¬ ì•žì„œ includeë¥¼ í†µí•´ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •í–ˆë˜ ë‹¤ë¥¸ ëª¨ë¸ì˜ ë°ì´í„°ë¥¼ `col` ë©”ì†Œë“œë¥¼ í†µí•´ ìž„ì˜ì˜ í‚¤ë¡œ ì§€ì •í•˜ì—¬ ê°€ì ¸ì˜¬ ìˆ˜ ìžˆë‹¤.

```javascript
[Sequelize.col("user.username"), "username"];
```

`col` ë©”ì†Œë“œì— ëŒ€í•´ ë” ì‚´íŽ´ë³´ìžë©´ ìœ„ êµ¬ë¬¸ì€ user ëª¨ë¸ ì•ˆì—ì„œ ê°€ì ¸ì˜¨ `user.username`ì„ `username`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.

> Creates a object representing a column in the DB. This is often useful in conjunction with `sequelize.fn`, since raw string arguments to fn will be escaped.

[.col | Sequelize Docs](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#static-method-col)
